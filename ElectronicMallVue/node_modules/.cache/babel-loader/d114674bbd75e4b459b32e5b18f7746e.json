{"ast":null,"code":"import _objectSpread from \"D:/Workspace/graduation_project/ElectronicMall/ElectronicMallVue/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _asyncToGenerator from \"D:/Workspace/graduation_project/ElectronicMall/ElectronicMallVue/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"regenerator-runtime/runtime.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { CanvasRenderer } from './canvasRenderer';\nimport API from '@/utils/request';\nexport default {\n  data: function data() {\n    return {\n      canvasWidth: 1300,\n      canvasHeight: 560,\n      gridSize: 20,\n      blockX: 0,\n      blockY: 0,\n      currentFloor: '一楼',\n      allShops: [],\n      firstFloorShops: [],\n      secondFloorShops: [],\n      firstFloorObstacles: [{\n        x: 3,\n        y: 11\n      }, {\n        x: 5,\n        y: 13\n      }],\n      secondFloorObstacles: [{\n        x: 4,\n        y: 5\n      }, {\n        x: 9,\n        y: 2\n      }],\n      pathStart: null,\n      pathEnd: null,\n      // UI状态\n      hoverInfo: '',\n      infoBoxVisible: false,\n      treeImage: new Image(),\n      mouseX: 0,\n      mouseY: 0\n    };\n  },\n  computed: {\n    currentFloorShops: function currentFloorShops() {\n      return this.currentFloor === '一楼' ? this.firstFloorShops : this.secondFloorShops;\n    },\n    currentFloorObstacles: function currentFloorObstacles() {\n      return this.currentFloor === '一楼' ? this.firstFloorObstacles : this.secondFloorObstacles;\n    },\n    infoBoxStyle: function infoBoxStyle() {\n      return {\n        display: this.infoBoxVisible ? 'block' : 'none',\n        left: this.mouseX + 'px',\n        top: this.mouseY + 'px'\n      };\n    }\n  },\n  created: function created() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _this.fetchShops();\n\n            case 2:\n              _this.treeImage.src = require('./Resources/tree.png');\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  mounted: function mounted() {\n    this.renderer = new CanvasRenderer(this, 'floorCanvas');\n    this.renderer.init();\n    this.canvas = document.getElementById('floorCanvas');\n    this.infoBox = document.getElementById('infoBox');\n    window.addEventListener('keydown', this.handleKeyPress);\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.renderer.destroy();\n    window.removeEventListener('keydown', this.handleKeyPress);\n  },\n  methods: {\n    fetchShops: function fetchShops() {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        var _yield$API$get, data;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                _context2.next = 3;\n                return API.get('/api/shops');\n\n              case 3:\n                _yield$API$get = _context2.sent;\n                data = _yield$API$get.data;\n                _this2.allShops = data.map(function (shop) {\n                  return {\n                    x: shop.x || 0,\n                    y: shop.y || 0,\n                    width: shop.width || 1,\n                    height: shop.height || 1,\n                    floor: Number(shop.floor) || 1,\n                    shopName: shop.shopName || '123',\n                    shape: shop.shape || 'rect' // 其他字段...\n\n                  };\n                });\n\n                _this2.sortShopsByFloor();\n\n                _context2.next = 12;\n                break;\n\n              case 9:\n                _context2.prev = 9;\n                _context2.t0 = _context2[\"catch\"](0);\n                console.error('数据加载失败:', _context2.t0);\n\n              case 12:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[0, 9]]);\n      }))();\n    },\n    sortShopsByFloor: function sortShopsByFloor() {\n      var _this3 = this;\n\n      this.firstFloorShops = this.allShops.filter(function (shop) {\n        return shop.floor == 1;\n      }).map(function (shop) {\n        return _objectSpread(_objectSpread({}, shop), {}, {\n          shape: _this3.getShopShape(shop)\n        });\n      });\n      this.secondFloorShops = this.allShops.filter(function (shop) {\n        return shop.floor == 2;\n      }).map(function (shop) {\n        return _objectSpread(_objectSpread({}, shop), {}, {\n          shape: _this3.getShopShape(shop)\n        });\n      });\n    },\n    getShopShape: function getShopShape(shop) {\n      if (shop.type == 'elevator') return 'elevator';\n      if (shop.width > 3) return 'rect';\n      return 'invertedHouse';\n    },\n    handleKeyPress: function handleKeyPress(e) {\n      var newPos = {\n        x: this.blockX,\n        y: this.blockY\n      };\n\n      switch (e.key) {\n        case 'ArrowUp':\n          newPos.y--;\n          break;\n\n        case 'ArrowDown':\n          newPos.y++;\n          break;\n\n        case 'ArrowLeft':\n          newPos.x--;\n          break;\n\n        case 'ArrowRight':\n          newPos.x++;\n          break;\n\n        case 'Enter':\n          if (!this.currentFloorShops) return;\n          var elevator = this.currentFloorShops.find(function (s) {\n            return s.shape === 'elevator';\n          });\n\n          if (elevator && this.blockX >= elevator.x && this.blockX < elevator.x + elevator.width && this.blockY >= elevator.y && this.blockY < elevator.y + elevator.height) {\n            if (this.currentFloor === '一楼') {\n              loadSecondFloor();\n            } else if (this.currentFloor === '二楼') {\n              loadFirstFloor();\n            }\n          }\n\n          break;\n      }\n\n      if (this.isValidPosition(newPos)) {\n        this.blockX = newPos.x;\n        this.blockY = newPos.y;\n      } // 新增空格键自动寻路\n\n\n      if (e.key === ' ') {\n        var start = {\n          x: this.blockX,\n          y: this.blockY\n        };\n        var end = this.pathEnd;\n\n        if (end) {\n          var path = this.renderer.pathfinder.findPath(start, end);\n\n          if (path) {\n            this.followPath(path);\n          }\n        }\n      }\n    },\n    isValidPosition: function isValidPosition(pos) {\n      return !this.currentFloorObstacles.some(function (o) {\n        return o.x === pos.x && o.y === pos.y;\n      });\n    },\n    handleMouseMove: function handleMouseMove(event) {\n      var rect = this.canvas.getBoundingClientRect();\n      var mouseX = event.clientX - rect.left;\n      var mouseY = event.clientY - rect.top;\n      var col = Math.floor(mouseX / this.gridSize);\n      var row = Math.floor(mouseY / this.gridSize);\n\n      if (!this.currentFloorShops) {\n        this.infoBoxVisible = false;\n        return;\n      }\n\n      var shop = this.currentFloorShops.find(function (s) {\n        if (s.shape === 'elevator') {\n          return col >= s.x && col < s.x + s.width && row >= s.y && row < s.y + s.height;\n        } else {\n          return col >= s.x && col < s.x + s.width && row >= s.y && row < s.y + s.height;\n        }\n      });\n      this.infoBoxVisible = !!shop;\n\n      if (shop) {\n        this.infoBox.style.left = event.clientX + 'px';\n        this.infoBox.style.top = event.clientY + 'px';\n        this.infoBox.textContent = shop.info;\n      }\n    },\n    handleClick: function handleClick(event) {\n      var rect = this.$el.getBoundingClientRect();\n      var gridX = Math.floor((event.clientX - rect.left) / this.gridSize);\n      var gridY = Math.floor((event.clientY - rect.top) / this.gridSize);\n\n      if (event.shiftKey) {\n        // 按住Shift点击设置起点\n        this.pathStart = {\n          x: gridX,\n          y: gridY - 2\n        };\n        console.log('设置起点:', this.pathStart);\n        this.renderer.drawColoredGrid(this.pathStart.x, this.pathStart.y, 'blue');\n      } else if (event.ctrlKey) {\n        // 按住Ctrl点击设置终点\n        this.pathEnd = {\n          x: gridX,\n          y: gridY\n        };\n        console.log('设置终点:', this.pathEnd.y);\n        this.renderer.drawColoredGrid(this.pathEnd.x, this.pathEnd.y, 'red');\n      }\n\n      if (this.pathStart && this.pathEnd) {\n        this.renderer.updatePath(this.pathStart, this.pathEnd);\n      }\n\n      if (this.hoverInfo) {\n        alert(this.hoverInfo);\n      }\n    },\n    followPath: function followPath(path) {\n      var _this4 = this;\n\n      var currentStep = 0;\n      var moveInterval = setInterval(function () {\n        if (currentStep >= path.length) {\n          clearInterval(moveInterval);\n          return;\n        }\n\n        var next = path[currentStep];\n\n        if (_this4.isValidPosition(next)) {\n          _this4.blockX = next.x;\n          _this4.blockY = next.y;\n          currentStep++;\n        } else {\n          clearInterval(moveInterval); // 路径被阻断\n        }\n      }, 300); // 每300ms移动一步\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["data","canvasWidth","canvasHeight","gridSize","blockX","blockY","currentFloor","allShops","firstFloorShops","secondFloorShops","firstFloorObstacles","x","y","secondFloorObstacles","pathStart","pathEnd","hoverInfo","infoBoxVisible","treeImage","mouseX","mouseY","computed","currentFloorShops","currentFloorObstacles","infoBoxStyle","display","left","top","created","mounted","window","beforeDestroy","methods","fetchShops","API","width","height","floor","shopName","shape","console","sortShopsByFloor","filter","map","shop","getShopShape","handleKeyPress","e","newPos","loadSecondFloor","loadFirstFloor","isValidPosition","pos","handleMouseMove","event","col","row","handleClick","alert","followPath","path","clearInterval","currentStep"],"sourceRoot":"src/views/front/mall","sources":["Tour.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"floor-info\">当前楼层: {{ currentFloor }}</div>\r\n    <canvas \r\n      id=\"floorCanvas\"\r\n      :width=\"canvasWidth\"\r\n      :height=\"canvasHeight\"\r\n      @mousemove=\"handleMouseMove\"\r\n      @click=\"handleClick\"\r\n    ></canvas>\r\n    <div \r\n      id=\"infoBox\"\r\n      :style=\"infoBoxStyle\"\r\n    >{{ hoverInfo }}</div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { CanvasRenderer } from './canvasRenderer';\r\nimport API from '@/utils/request';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      canvasWidth: 1300,\r\n      canvasHeight: 560,\r\n      gridSize: 20,\r\n      \r\n      blockX: 0,\r\n      blockY: 0,\r\n      currentFloor: '一楼',\r\n      \r\n      allShops: [],\r\n      firstFloorShops: [],\r\n      secondFloorShops: [],\r\n      firstFloorObstacles: [\r\n        { x: 3, y: 11 },\r\n        { x: 5, y: 13 }\r\n      ],\r\n      secondFloorObstacles: [\r\n        { x: 4, y: 5 },\r\n        { x: 9, y: 2 }\r\n      ],\r\n      pathStart: null,\r\n      pathEnd: null,\r\n      \r\n      // UI状态\r\n      hoverInfo: '',\r\n      infoBoxVisible: false,\r\n      treeImage: new Image(),\r\n      mouseX: 0,\r\n      mouseY: 0\r\n    };\r\n  },\r\n\r\n  computed: {\r\n    currentFloorShops() {\r\n      return this.currentFloor === '一楼' \r\n        ? this.firstFloorShops \r\n        : this.secondFloorShops;\r\n    },\r\n    currentFloorObstacles() {\r\n      return this.currentFloor === '一楼'\r\n        ? this.firstFloorObstacles\r\n        : this.secondFloorObstacles;\r\n    },\r\n    infoBoxStyle() {\r\n      return {\r\n        display: this.infoBoxVisible ? 'block' : 'none',\r\n        left: this.mouseX + 'px',\r\n        top: this.mouseY + 'px',\r\n      }; \r\n    }\r\n  },\r\n\r\n  async created() {\r\n    await this.fetchShops();\r\n    this.treeImage.src = require('./Resources/tree.png');\r\n  },\r\n\r\n  mounted() {\r\n    this.renderer = new CanvasRenderer(this, 'floorCanvas');\r\n    this.renderer.init();\r\n    this.canvas = document.getElementById('floorCanvas');\r\n    this.infoBox = document.getElementById('infoBox');\r\n    window.addEventListener('keydown', this.handleKeyPress);\r\n    \r\n  },\r\n\r\n  beforeDestroy() {\r\n    this.renderer.destroy();\r\n    window.removeEventListener('keydown', this.handleKeyPress);\r\n  },\r\n\r\n  methods: {\r\n    async fetchShops() {\r\n      try {\r\n        const { data } = await API.get('/api/shops');\r\n        this.allShops = data.map(shop => ({\r\n          x: shop.x || 0,\r\n          y: shop.y || 0,\r\n          width: shop.width || 1,\r\n          height: shop.height || 1,\r\n          floor: Number(shop.floor) || 1,\r\n          shopName: shop.shopName || '123',\r\n          shape: shop.shape || 'rect'\r\n          // 其他字段...\r\n        }));\r\n\r\n        this.sortShopsByFloor();\r\n      } catch (error) {\r\n        console.error('数据加载失败:', error);\r\n      }\r\n    },\r\n\r\n    sortShopsByFloor() {\r\n      this.firstFloorShops = this.allShops\r\n        .filter(shop => shop.floor == 1)\r\n        .map(shop => ({\r\n          ...shop,\r\n          shape: this.getShopShape(shop)\r\n        }));\r\n      \r\n      this.secondFloorShops = this.allShops\r\n        .filter(shop => shop.floor == 2)\r\n        .map(shop => ({\r\n          ...shop,\r\n          shape: this.getShopShape(shop)\r\n        }));\r\n    },\r\n\r\n    getShopShape(shop) {\r\n      if (shop.type == 'elevator') return 'elevator';\r\n      if (shop.width > 3) return 'rect';\r\n      return 'invertedHouse';\r\n    },\r\n\r\n    handleKeyPress(e) {\r\n      const newPos = { x: this.blockX, y: this.blockY };\r\n      switch(e.key) {\r\n        case 'ArrowUp': newPos.y--; break;\r\n        case 'ArrowDown': newPos.y++; break;\r\n        case 'ArrowLeft': newPos.x--; break;\r\n        case 'ArrowRight': newPos.x++; break;\r\n        case 'Enter':\r\n          if (!this.currentFloorShops) return;          \r\n          const elevator = this.currentFloorShops.find(s => s.shape === 'elevator');\r\n          if (elevator && \r\n              this.blockX >= elevator.x &&\r\n              this.blockX < elevator.x + elevator.width &&\r\n              this.blockY >= elevator.y &&\r\n              this.blockY < elevator.y + elevator.height\r\n          ) {\r\n            if (this.currentFloor === '一楼') {\r\n              loadSecondFloor();\r\n            } else if (this.currentFloor === '二楼') {\r\n              loadFirstFloor();\r\n            }\r\n          }\r\n          break;\r\n      }\r\n\r\n      if (this.isValidPosition(newPos)) {\r\n        this.blockX = newPos.x;\r\n        this.blockY = newPos.y;\r\n      }\r\n\r\n      // 新增空格键自动寻路\r\n      if (e.key === ' ') {\r\n        const start = { x: this.blockX, y: this.blockY };\r\n        const end = this.pathEnd;\r\n        if (end) {\r\n          const path = this.renderer.pathfinder.findPath(start, end);\r\n          if (path) {\r\n            this.followPath(path);\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n    isValidPosition(pos) {\r\n      return !this.currentFloorObstacles.some(\r\n        o => o.x === pos.x && o.y === pos.y\r\n      );\r\n    },\r\n\r\n    handleMouseMove  (event) {\r\n      const rect = this.canvas.getBoundingClientRect();\r\n      const mouseX = event.clientX - rect.left;\r\n      const mouseY = event.clientY - rect.top;\r\n\r\n      const col = Math.floor(mouseX / this.gridSize);\r\n      const row = Math.floor(mouseY / this.gridSize);\r\n\r\n      if (!this.currentFloorShops) {\r\n        this.infoBoxVisible = false;\r\n        return;\r\n      }\r\n      \r\n      const shop = this.currentFloorShops.find(s => {\r\n        if (s.shape === 'elevator') {\r\n          return (\r\n            col >= s.x &&\r\n            col < s.x + s.width &&\r\n            row >= s.y &&\r\n            row < s.y + s.height\r\n          );\r\n        } else {\r\n          return (\r\n            col >= s.x &&\r\n            col < s.x + s.width &&\r\n            row >= s.y &&\r\n            row < s.y + s.height\r\n          );\r\n        }\r\n      });\r\n      this.infoBoxVisible = !!shop;\r\n      if (shop) {\r\n        this.infoBox.style.left = event.clientX + 'px';\r\n        this.infoBox.style.top = event.clientY + 'px';\r\n        this.infoBox.textContent = shop.info;\r\n      }\r\n    },\r\n    handleClick(event) {\r\n      const rect = this.$el.getBoundingClientRect();\r\n      const gridX = Math.floor((event.clientX - rect.left) / this.gridSize);\r\n      const gridY = Math.floor((event.clientY - rect.top) / this.gridSize);\r\n\r\n      if (event.shiftKey) { // 按住Shift点击设置起点\r\n        this.pathStart = { x: gridX, y: gridY -2};\r\n        console.log('设置起点:', this.pathStart);\r\n        this.renderer.drawColoredGrid(this.pathStart.x, this.pathStart.y, 'blue');\r\n      } else if (event.ctrlKey) { // 按住Ctrl点击设置终点\r\n        this.pathEnd = { x: gridX, y: gridY };\r\n        console.log('设置终点:', this.pathEnd.y);\r\n        this.renderer.drawColoredGrid(this.pathEnd.x, this.pathEnd.y, 'red');\r\n      }\r\n      \r\n      if (this.pathStart && this.pathEnd) {\r\n        this.renderer.updatePath(this.pathStart, this.pathEnd);\r\n      }\r\n\r\n      if (this.hoverInfo) {\r\n        alert(this.hoverInfo);\r\n      }\r\n    },\r\n\r\n    followPath(path) {\r\n      let currentStep = 0;\r\n      const moveInterval = setInterval(() => {\r\n        if (currentStep >= path.length) {\r\n          clearInterval(moveInterval);\r\n          return;\r\n        }\r\n        \r\n        const next = path[currentStep];\r\n        if (this.isValidPosition(next)) {\r\n          this.blockX = next.x;\r\n          this.blockY = next.y;\r\n          currentStep++;\r\n        } else {\r\n          clearInterval(moveInterval); // 路径被阻断\r\n        }\r\n      }, 300); // 每300ms移动一步\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.floor-info {\r\n  text-align: center;\r\n  font-size: 18px;\r\n  margin: 10px 0;\r\n}\r\n\r\ncanvas {\r\n  border: 1px solid #ccc;\r\n  background: #fff;\r\n}\r\n\r\n#infoBox {\r\n  position: fixed;\r\n  background: rgba(255,255,255,0.9);\r\n  border: 1px solid #333;\r\n  padding: 8px;\r\n  pointer-events: none;\r\n  box-shadow: 2px 2px 5px rgba(0,0,0,0.2);\r\n}\r\n</style>    "]},"metadata":{},"sourceType":"module"}